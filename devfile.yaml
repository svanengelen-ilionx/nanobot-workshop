schemaVersion: 2.2.2
metadata:
  name: nanobot-workshop
  displayName: NanoBot AI Assistant Workshop
  description: Workshop environment for exploring the NanoBot AI assistant
  tags:
    - Python
    - AI
    - NanoBot
  version: 1.0.0

components:
  - name: nanobot
    container:
      image: harbor.openshift-sandbox.ilionx-ocp.com:60443/nanobot/nanobot-workshop:latest
      memoryLimit: 2Gi
      memoryRequest: 512Mi
      cpuLimit: "2"
      cpuRequest: 250m
      mountSources: true
      sourceMapping: /projects
      env:
        - name: HOME
          value: /home/user
      endpoints:
        - name: nanobot-gateway
          targetPort: 18790
          exposure: public
          protocol: https
        - name: webapp
          targetPort: 8080
          exposure: public
          protocol: https

commands:
  - id: init-symlink
    exec:
      component: nanobot
      commandLine: |
        # Link into the project folder so it shows up in the VS Code explorer
        PROJECT_DIR=$(find /projects -maxdepth 1 -type d | grep -v "^/projects$" | head -n 1)
        if [ -n "$PROJECT_DIR" ]; then
          [ -L "$PROJECT_DIR/nanobot-home" ] || ln -s $HOME/.nanobot "$PROJECT_DIR/nanobot-home"
        fi

  - id: nanobot-status
    exec:
      label: "NanoBot: Show Status"
      component: nanobot
      commandLine: nanobot status
      group:
        kind: run

  - id: nanobot-chat
    exec:
      label: "NanoBot: Interactive Chat"
      component: nanobot
      commandLine: nanobot agent
      group:
        kind: run

  - id: nanobot-gateway
    exec:
      label: "NanoBot: Start Gateway (Telegram)"
      component: nanobot
      commandLine: nanobot gateway
      group:
        kind: run

  - id: setup-config
    exec:
      label: "Workshop: Setup Config"
      component: nanobot
      commandLine: |
        if [ ! -f $HOME/.nanobot/config.json ] || [ "$(cat $HOME/.nanobot/config.json)" = "{}" ]; then
          cp /app/config-template.json $HOME/.nanobot/config.json
          echo "Config template copied to ~/.nanobot/config.json"
          echo "Edit it with: nano ~/.nanobot/config.json"
        else
          echo "Config already exists at ~/.nanobot/config.json"
        fi
      group:
        kind: build

events:
  postStart:
    - init-symlink